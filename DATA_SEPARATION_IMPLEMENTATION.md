# ุชูููุฐ ูุตู ุงูุจูุงูุงุช ุจูู ุงููุณุชุฎุฏููู

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุชุญุณูู ุงููุธุงู ูุถูุงู ุฃู ูู ูุณุชุฎุฏู (ูุงูุฏ) ูู ุจูุงูุงุชู ุงููููุตูุฉ ุชูุงูุงูุ ูุฃู ูู ุทูู ูุจุฏุฃ ูู ุงูุตูุฑ ูุน ุฅูุฌุงุฒุงุช ููุณุชููุงุช ูููุตูุฉ.

## ุงูุชุญุณููุงุช ุงููููุฐุฉ

### 1. ุชุญุณูู ุณูุงุณุงุช ุงูุฃูุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
**ุงูููู:** `database/security-policies.sql`

- **ุฅุฒุงูุฉ ุงูุณูุงุณุงุช ุงูููุชูุญุฉ:** ุชู ุญุฐู ุฌููุน ุงูุณูุงุณุงุช ุงูุชู ุชุณูุญ ููุฌููุน ุจุงููุตูู ููุจูุงูุงุช
- **ุณูุงุณุงุช ูุฎุตุตุฉ ูููุณุชุฎุฏููู:** ูู ูุณุชุฎุฏู ููููู ุงููุตูู ููุท ูุจูุงูุงุชู ุงูุดุฎุตูุฉ
- **ุณูุงุณุงุช ูุฎุตุตุฉ ููุงุนุจูู:** ูู ูุณุชุฎุฏู ููููู ุงููุตูู ููุท ูุฃุทูุงูู
- **ุญูุงูุฉ ุงููุชุงุฆุฌ ูุงูุฅูุฌุงุฒุงุช:** ูุฑุชุจุทุฉ ุจููููุฉ ุงููุงุนุจ
- **ูุธุงุฆู ูุญููุฉ:** ุชู ุชุญุฏูุซ ูุธุงุฆู ุฅุถุงูุฉ ุงูุนููุงุช ูุงูุฎุจุฑุฉ ููุชุญูู ูู ุงูููููุฉ

### 2. ุชุญุณูู ุฎุฏูุฉ ุงููุงุนุจูู (PlayerService)
**ุงูููู:** `services/PlayerService.ts`

#### ุงูุชุญุณููุงุช:
- **getPlayers():** ูุชุทูุจ ุงูุขู userId ููุง ูุนูุฏ ุจูุงูุงุช ุจุฏููู
- **updatePlayerProgress():** ูุชุญูู ูู ููููุฉ ุงููุงุนุจ ูุจู ุงูุชุญุฏูุซ
- **updateStoryStats():** ูุชุญูู ูู ููููุฉ ุงููุงุนุจ ูุจู ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงููุฑุงุกุฉ
- **createPlayer():** ููุดุฆ ูุงุนุจูู ุฌุฏุฏ ุจุฅูุฌุงุฒุงุช ููุณุชููุงุช ูุงุฑุบุฉ

#### ูุซุงู ุนูู ุงูุชุญูู ูู ุงูุฃูุงู:
```typescript
if (player.userId !== userId) {
  console.error('โ Security violation: Player does not belong to current user');
  throw new Error('ุบูุฑ ูุณููุญ: ุงููุงุนุจ ูุง ููุชูู ูููุณุชุฎุฏู ุงูุญุงูู');
}
```

### 3. ุชุญุณูู ุฎุฏูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช (SupabaseService)
**ุงูููู:** `services/SupabaseService.ts`

#### ุงูุชุญุณููุงุช:
- **unlockAchievement():** ูุชุญูู ูู ููููุฉ ุงููุงุนุจ ูุจู ูุชุญ ุงูุฅูุฌุงุฒุงุช
- **ุชุณุฌูู ููุตู:** ุฅุถุงูุฉ ุฑุณุงุฆู ูุงุถุญุฉ ูุชุชุจุน ุงูุนูููุงุช
- **ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุญุณูุฉ:** ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุนูุฏ ุงูุชูุงู ุงูุฃูุงู

### 4. ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช
**ุงูููู:** `database/setup.sql`

#### ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ:
- **users:** ุจูุงูุงุช ุงููุณุชุฎุฏููู (ุงูุขุจุงุก)
- **players:** ุจูุงูุงุช ุงููุงุนุจูู (ุงูุฃุทูุงู) ูุฑุชุจุทุฉ ุจู user_id
- **game_scores:** ูุชุงุฆุฌ ุงูุฃูุนุงุจ ูุฑุชุจุทุฉ ุจู player_id
- **player_achievements:** ุฅูุฌุงุฒุงุช ุงููุงุนุจูู ูุฑุชุจุทุฉ ุจู player_id
- **player_settings:** ุฅุนุฏุงุฏุงุช ุงููุงุนุจูู ูุฑุชุจุทุฉ ุจู player_id

#### ุงูุนูุงูุงุช:
```sql
players.user_id โ users.id (CASCADE DELETE)
game_scores.player_id โ players.id (CASCADE DELETE)
player_achievements.player_id โ players.id (CASCADE DELETE)
```

## ุถูุงูุงุช ุงูุฃูุงู

### 1. ูุตู ุงูุจูุงูุงุช
- โ ูู ูุณุชุฎุฏู ูุฑู ููุท ุฃุทูุงูู
- โ ูู ุทูู ูู ุฅูุฌุงุฒุงุชู ุงููููุตูุฉ
- โ ูู ุทูู ูู ูุชุงุฆุฌู ุงููููุตูุฉ
- โ ูู ุทูู ูู ุฅุนุฏุงุฏุงุชู ุงููููุตูุฉ

### 2. ุงูุจุฏุงูุฉ ูู ุงูุตูุฑ
- โ ูู ุทูู ุฌุฏูุฏ ูุจุฏุฃ ุจู:
  - `totalScore: 0`
  - `gamesCompleted: 0`
  - `storiesCompleted: 0`
  - `achievements: []`
  - `gameProgress: {}`
  - `storyProgress: {}`

### 3. ุงูุชุญูู ูู ุงูููููุฉ
- โ ุฌููุน ุงูุนูููุงุช ุชุชุญูู ูู ุฃู ุงููุงุนุจ ููุชูู ูููุณุชุฎุฏู ุงูุญุงูู
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุนูุฏ ุงูุชูุงู ุงูุฃูุงู
- โ ุชุณุฌูู ููุตู ูุฌููุน ุงูุนูููุงุช

## ููููุฉ ุงูุชุทุจูู

### 1. ุชุทุจูู ุณูุงุณุงุช ุงูุฃูุงู
```sql
-- ูู Supabase SQL Editor
\i database/security-policies.sql
```

### 2. ุงูุชุญูู ูู ุงูุชุทุจูู
```typescript
// ูุซุงู ุนูู ุงุณุชุฎุฏุงู ุขูู
const players = await PlayerService.getPlayers(currentUser.id);
const success = await PlayerService.updatePlayerProgress(
  playerId, 
  gameType, 
  score, 
  currentUser.id
);
```

## ุงูููุงุฆุฏ

### 1. ุงูุฃูุงู
- ุญูุงูุฉ ูุงููุฉ ููุจูุงูุงุช ุงูุดุฎุตูุฉ
- ููุน ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจู
- ุชุชุจุน ุฌููุน ุงูุนูููุงุช

### 2. ุงูุฎุตูุตูุฉ
- ูู ุนุงุฆูุฉ ููุง ุจูุงูุงุชูุง ุงููููุตูุฉ
- ูุง ูููู ููุณุชุฎุฏู ุฑุคูุฉ ุจูุงูุงุช ูุณุชุฎุฏู ุขุฎุฑ
- ุญูุงูุฉ ุจูุงูุงุช ุงูุฃุทูุงู

### 3. ุงูุชุฌุฑุจุฉ
- ูู ุทูู ูุจุฏุฃ ุฑุญูุชู ูู ุงูุตูุฑ
- ุฅูุฌุงุฒุงุช ุดุฎุตูุฉ ููู ุทูู
- ุชูุฏู ูููุตู ููู ุทูู

## ุงุฎุชุจุงุฑ ุงููุธุงู

### 1. ุฅูุดุงุก ูุณุชุฎุฏููู ูุชุนุฏุฏูู
```typescript
// ูุณุชุฎุฏู 1
const user1 = await authService.signup('parent1@example.com', 'password');
const child1 = await PlayerService.createPlayer(user1.id, 'ุฃุญูุฏ', '๐ฆ', 'ar');

// ูุณุชุฎุฏู 2
const user2 = await authService.signup('parent2@example.com', 'password');
const child2 = await PlayerService.createPlayer(user2.id, 'ูุงุทูุฉ', '๐ง', 'ar');
```

### 2. ุงูุชุญูู ูู ุงููุตู
```typescript
// ุงููุณุชุฎุฏู 1 ูุฑู ููุท ุฃุทูุงูู
const user1Players = await PlayerService.getPlayers(user1.id); // [ุฃุญูุฏ]

// ุงููุณุชุฎุฏู 2 ูุฑู ููุท ุฃุทูุงูู
const user2Players = await PlayerService.getPlayers(user2.id); // [ูุงุทูุฉ]
```

### 3. ุงูุชุญูู ูู ุงูุฃูุงู
```typescript
// ูุญุงููุฉ ูุตูู ุบูุฑ ูุตุฑุญ ุจู - ุณุชูุดู
try {
  await PlayerService.updatePlayerProgress(child1.id, 'math', 100, user2.id);
} catch (error) {
  console.log('โ Security working: ' + error.message);
}
```

## ุงูุฎูุงุตุฉ

ุชู ุชูููุฐ ูุธุงู ุดุงูู ูุถูุงู:
- **ูุตู ูุงูู ููุจูุงูุงุช** ุจูู ุงููุณุชุฎุฏููู
- **ุจุฏุงูุฉ ูู ุงูุตูุฑ** ููู ุทูู ุฌุฏูุฏ
- **ุญูุงูุฉ ูููุฉ** ููุจูุงูุงุช ุงูุดุฎุตูุฉ
- **ุชุฌุฑุจุฉ ุขููุฉ ููุฎุตุตุฉ** ููู ุนุงุฆูุฉ

ุงููุธุงู ุงูุขู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูุขูู ูุน ุถูุงู ุฎุตูุตูุฉ ูุฃูุงู ุจูุงูุงุช ุฌููุน ุงููุณุชุฎุฏููู ูุฃุทูุงููู.